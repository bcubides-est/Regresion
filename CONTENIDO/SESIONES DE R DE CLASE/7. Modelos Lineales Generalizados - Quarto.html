<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.34">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Brayan Cubides">
<meta name="description" content="Material del curso de Regresión">

<title>15&nbsp; Modelos Lineales Generalizados GAM – REGRESIÓN</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../CONTENIDO/SESIONES DE R DE CLASE/6. Modelos Generalizados Aditivos - Quarto.html" rel="prev">
<link href="../../logo.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-c8ad9e5dbd60b7b70b38521ab19b7da4.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-befe23ebd2f54d8af2c8a89d1a1611f1.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-c8ad9e5dbd60b7b70b38521ab19b7da4.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-1576b7f44e921869da47e1cec3b10ace.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark-11b40462b1fd69077417d3391b01ca80.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../../site_libs/bootstrap/bootstrap-1576b7f44e921869da47e1cec3b10ace.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script src="../../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="custom.css">
</head>

<body class="nav-sidebar floating quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../CONTENIDO/SESIONES DE R DE CLASE/7. Modelos Lineales Generalizados - Quarto.html"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Modelos Lineales Generalizados GAM</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="../../index.html" class="sidebar-logo-link">
      <img src="../../logo.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">REGRESIÓN</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://bcubides-est.github.io/website/inicio.html" title="Ir a mi web" class="quarto-navigation-tool px-1" aria-label="Ir a mi web"><i class="bi bi-globe"></i></a>
    <a href="javascript:window.print()" title="Descargar (PDF)" class="quarto-navigation-tool px-1" aria-label="Descargar (PDF)"><i class="bi bi-download"></i></a>
    <a href="https://github.com/bcubides-est/Regresion" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">INTRODUCCIÓN</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../CONTENIDO/SESIONES DE R DE CLASE/0. TODO de Estadística Descriptiva - Clase Profe Mario - Quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Intro a analizar Base de Datos, y gráficos</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../CONTENIDO/SESIONES DE R DE CLASE/1. ANOVA_oneway - Quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">ANOVA_oneway</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../CONTENIDO/SESIONES DE R DE CLASE/2. Regresion Lineal Simple - Quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Regresion Lineal Simple</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../CONTENIDO/CORTE 1 - Regresión Lineal Simple/Taller 1 Regresión - Quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Taller 1</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../CONTENIDO/CORTE 1 - Regresión Lineal Simple/Parcial 1 - Parte B - Quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Parcial 1 - Parte B</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../CONTENIDO/SESIONES DE R DE CLASE/3. Regresion lineal multiple - Quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Regresion lineal multiple</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../CONTENIDO/SESIONES DE R DE CLASE/4. Heteroscedasticidad - Quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Heteroscedasticidad</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../CONTENIDO/SESIONES DE R DE CLASE/4. Validación del Modelo - Quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Validación del Modelo</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../CONTENIDO/CORTE 2 - Regresión Multiple y Diagnostico del Modelo/Parcial 2 - Parte B - Quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Parcial 2 - Parte B</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../CONTENIDO/PROYECTO/Proyecto 2 - Quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Proyecto 2</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../CONTENIDO/SESIONES DE R DE CLASE/5. Selección del modelo. Regre RIDGE y LASSO - Quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Selección del modelo. Regre RIDGE y LASSO</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../CONTENIDO/SESIONES DE R DE CLASE/6. Densidad No Paramétrica - Quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Estimación de Densidad por Kernel</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../CONTENIDO/SESIONES DE R DE CLASE/6. Modelos Generalizados Aditivos - Quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Modelos Generalizados Aditivos</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../CONTENIDO/SESIONES DE R DE CLASE/7. Modelos Lineales Generalizados - Quarto.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Modelos Lineales Generalizados GAM</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul class="collapse">
  <li><a href="#introducción" id="toc-introducción" class="nav-link active" data-scroll-target="#introducción"><span class="header-section-number">16</span> Introducción</a></li>
  <li><a href="#ejercicio-1-bondad-de-ajuste-en-regresión-logística" id="toc-ejercicio-1-bondad-de-ajuste-en-regresión-logística" class="nav-link" data-scroll-target="#ejercicio-1-bondad-de-ajuste-en-regresión-logística"><span class="header-section-number">17</span> EJERCICIO 1: Bondad de Ajuste en Regresión Logística</a>
  <ul class="collapse">
  <li><a href="#a-análisis-de-estadística-descriptiva" id="toc-a-análisis-de-estadística-descriptiva" class="nav-link" data-scroll-target="#a-análisis-de-estadística-descriptiva"><span class="header-section-number">17.1</span> a) Análisis de Estadística Descriptiva</a></li>
  <li><a href="#b-d-ajuste-de-un-primer-modelo-logístico" id="toc-b-d-ajuste-de-un-primer-modelo-logístico" class="nav-link" data-scroll-target="#b-d-ajuste-de-un-primer-modelo-logístico"><span class="header-section-number">17.2</span> b-d) Ajuste de un Primer Modelo Logístico</a></li>
  <li><a href="#e-interpretación-de-los-parámetros-odds-ratios" id="toc-e-interpretación-de-los-parámetros-odds-ratios" class="nav-link" data-scroll-target="#e-interpretación-de-los-parámetros-odds-ratios"><span class="header-section-number">17.3</span> e) Interpretación de los Parámetros (Odds Ratios)</a></li>
  <li><a href="#f-elección-de-una-función-de-enlace-por-bondad-de-ajuste" id="toc-f-elección-de-una-función-de-enlace-por-bondad-de-ajuste" class="nav-link" data-scroll-target="#f-elección-de-una-función-de-enlace-por-bondad-de-ajuste"><span class="header-section-number">17.4</span> f) Elección de una Función de Enlace por Bondad de Ajuste</a></li>
  <li><a href="#g-h-selección-automática-del-modelo" id="toc-g-h-selección-automática-del-modelo" class="nav-link" data-scroll-target="#g-h-selección-automática-del-modelo"><span class="header-section-number">17.5</span> g-h) Selección Automática del Modelo</a></li>
  <li><a href="#i-validación-de-supuestos" id="toc-i-validación-de-supuestos" class="nav-link" data-scroll-target="#i-validación-de-supuestos"><span class="header-section-number">17.6</span> i) Validación de Supuestos</a></li>
  </ul></li>
  <li><a href="#ejercicio-2-predicción-del-mercado-de-valores" id="toc-ejercicio-2-predicción-del-mercado-de-valores" class="nav-link" data-scroll-target="#ejercicio-2-predicción-del-mercado-de-valores"><span class="header-section-number">18</span> EJERCICIO 2: Predicción del Mercado de Valores</a>
  <ul class="collapse">
  <li><a href="#b-ajuste-del-modelo" id="toc-b-ajuste-del-modelo" class="nav-link" data-scroll-target="#b-ajuste-del-modelo"><span class="header-section-number">18.1</span> b) Ajuste del Modelo</a></li>
  <li><a href="#c-matriz-de-confusión-con-todos-los-datos" id="toc-c-matriz-de-confusión-con-todos-los-datos" class="nav-link" data-scroll-target="#c-matriz-de-confusión-con-todos-los-datos"><span class="header-section-number">18.2</span> c) Matriz de Confusión (con todos los datos)</a></li>
  <li><a href="#d-entrenamiento-y-prueba" id="toc-d-entrenamiento-y-prueba" class="nav-link" data-scroll-target="#d-entrenamiento-y-prueba"><span class="header-section-number">18.3</span> d) Entrenamiento y Prueba</a></li>
  </ul></li>
  <li><a href="#ejercicio-3-habilidad-predictiva" id="toc-ejercicio-3-habilidad-predictiva" class="nav-link" data-scroll-target="#ejercicio-3-habilidad-predictiva"><span class="header-section-number">19</span> EJERCICIO 3: Habilidad Predictiva</a>
  <ul class="collapse">
  <li><a href="#a-muestreo-estratificado" id="toc-a-muestreo-estratificado" class="nav-link" data-scroll-target="#a-muestreo-estratificado"><span class="header-section-number">19.1</span> a) Muestreo Estratificado</a></li>
  <li><a href="#b-entrenamiento-del-modelo-y-selección-de-variables" id="toc-b-entrenamiento-del-modelo-y-selección-de-variables" class="nav-link" data-scroll-target="#b-entrenamiento-del-modelo-y-selección-de-variables"><span class="header-section-number">19.2</span> b) Entrenamiento del Modelo y Selección de Variables</a></li>
  <li><a href="#c-selección-del-mejor-modelo-global-por-habilidad-predictiva" id="toc-c-selección-del-mejor-modelo-global-por-habilidad-predictiva" class="nav-link" data-scroll-target="#c-selección-del-mejor-modelo-global-por-habilidad-predictiva"><span class="header-section-number">19.3</span> c) Selección del Mejor Modelo Global por Habilidad Predictiva</a></li>
  <li><a href="#elección-del-punto-de-corte-tau-óptimo" id="toc-elección-del-punto-de-corte-tau-óptimo" class="nav-link" data-scroll-target="#elección-del-punto-de-corte-tau-óptimo"><span class="header-section-number">19.4</span> Elección del Punto de Corte (<code>tau</code>) Óptimo</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Modelos Lineales Generalizados GAM</span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Brayan Cubides </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="introducción" class="level1" data-number="16">
<h1 data-number="16"><span class="header-section-number">16</span> Introducción</h1>
<p>Este documento explora los <strong>Modelos Lineales Generalizados (GLM)</strong>, con un enfoque en la regresión logística para variables de respuesta binarias. Se divide en tres ejercicios principales:</p>
<ol type="1">
<li><p><strong>Ejercicio 1</strong>: Se ajusta un modelo logístico, se interpretan sus coeficientes, se comparan diferentes funciones de enlace y se realiza una selección automática de variables.</p></li>
<li><p><strong>Ejercicio 2</strong>: Se aplica la regresión logística para predecir la dirección del mercado de valores, introduciendo el concepto de dividir los datos en conjuntos de entrenamiento y prueba.</p></li>
<li><p><strong>Ejercicio 3</strong>: Se profundiza en la evaluación de la <strong>habilidad predictiva</strong> del modelo, utilizando muestreo estratificado, curvas ROC, y la optimización de un punto de corte (<code>tau</code>) para la clasificación.</p></li>
</ol>
<section id="librerías-requeridas" class="level3" data-number="16.0.1">
<h3 data-number="16.0.1" class="anchored" data-anchor-id="librerías-requeridas"><span class="header-section-number">16.0.1</span> Librerías Requeridas</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmtoolbox) <span class="co"># Para stepCriterion() y envelope()</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(aplore3)    <span class="co"># Para el dataset burn1000</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ISLR2)      <span class="co"># Para el dataset Smarket</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="ejercicio-1-bondad-de-ajuste-en-regresión-logística" class="level1" data-number="17">
<h1 data-number="17"><span class="header-section-number">17</span> EJERCICIO 1: Bondad de Ajuste en Regresión Logística</h1>
<p>Se utiliza el conjunto de datos <code>burn1000</code> para modelar la probabilidad de muerte (<code>death</code>) en función de varios factores de riesgo.</p>
<section id="a-análisis-de-estadística-descriptiva" class="level2" data-number="17.1">
<h2 data-number="17.1" class="anchored" data-anchor-id="a-análisis-de-estadística-descriptiva"><span class="header-section-number">17.1</span> a) Análisis de Estadística Descriptiva</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>burn1000 <span class="ot">&lt;-</span> aplore3<span class="sc">::</span>burn1000</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Se crea la variable de respuesta binaria: 1 = "Dead" (éxito), 0 = "Alive"</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>burn1000 <span class="ot">&lt;-</span> <span class="fu">within</span>(burn1000, death2 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(death <span class="sc">==</span> <span class="st">"Dead"</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(burn1000)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   1000 obs. of  10 variables:
 $ id      : int  1 2 3 4 5 6 7 8 9 10 ...
 $ facility: int  11 1 12 1 1 6 22 1 1 1 ...
 $ death   : Factor w/ 2 levels "Alive","Dead": 1 1 1 1 1 1 1 1 1 1 ...
 $ age     : num  26.6 2 22 37.3 52.1 50.2 2.5 53.8 31.9 41.1 ...
 $ gender  : Factor w/ 2 levels "Female","Male": 2 1 1 2 2 2 1 1 2 2 ...
 $ race    : Factor w/ 2 levels "Non-White","White": 2 1 1 2 2 2 1 2 2 2 ...
 $ tbsa    : num  25.3 5 2 2 6 7 7 0.9 2 22 ...
 $ inh_inj : Factor w/ 2 levels "No","Yes": 1 1 1 1 1 1 1 1 1 1 ...
 $ flame   : Factor w/ 2 levels "No","Yes": 2 1 1 1 2 1 1 2 1 2 ...
 $ death2  : num  0 0 0 0 0 0 0 0 0 0 ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(burn1000)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       id            facility       death          age           gender   
 Min.   :   1.0   Min.   : 1.00   Alive:850   Min.   : 0.10   Female:295  
 1st Qu.: 250.8   1st Qu.: 2.00   Dead :150   1st Qu.:10.85   Male  :705  
 Median : 500.5   Median : 8.00               Median :31.95               
 Mean   : 500.5   Mean   :11.56               Mean   :33.29               
 3rd Qu.: 750.2   3rd Qu.:18.25               3rd Qu.:51.23               
 Max.   :1000.0   Max.   :40.00               Max.   :89.70               
        race          tbsa       inh_inj   flame         death2    
 Non-White:411   Min.   : 0.10   No :878   No :471   Min.   :0.00  
 White    :589   1st Qu.: 2.50   Yes:122   Yes:529   1st Qu.:0.00  
                 Median : 6.00                       Median :0.00  
                 Mean   :13.54                       Mean   :0.15  
                 3rd Qu.:16.00                       3rd Qu.:0.00  
                 Max.   :98.00                       Max.   :1.00  </code></pre>
</div>
</div>
</section>
<section id="b-d-ajuste-de-un-primer-modelo-logístico" class="level2" data-number="17.2">
<h2 data-number="17.2" class="anchored" data-anchor-id="b-d-ajuste-de-un-primer-modelo-logístico"><span class="header-section-number">17.2</span> b-d) Ajuste de un Primer Modelo Logístico</h2>
<p>Se ajusta un GLM con una distribución <code>binomial</code> y una función de enlace <code>logit</code>. El modelo es: <span class="math display">\[
\log\left(\frac{p_i}{1-p_i}\right) = \beta_0 + \beta_1 x_{i1} + \dots + \beta_k x_{ik}
\]</span> donde <span class="math inline">\(p_i\)</span> es la probabilidad de “éxito” (muerte) para el individuo <span class="math inline">\(i\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Definir el Modelo Lineal Generalizado</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>fit1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(death2 <span class="sc">~</span> age <span class="sc">+</span> gender <span class="sc">+</span> race <span class="sc">+</span> tbsa <span class="sc">+</span> inh_inj <span class="sc">+</span> flame, </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">family =</span> <span class="fu">binomial</span>(<span class="st">"logit"</span>), <span class="at">data =</span> burn1000)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = death2 ~ age + gender + race + tbsa + inh_inj + 
    flame, family = binomial("logit"), data = burn1000)

Coefficients:
             Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -7.695153   0.691169 -11.134  &lt; 2e-16 ***
age          0.082890   0.008629   9.606  &lt; 2e-16 ***
genderMale  -0.201494   0.307784  -0.655 0.512687    
raceWhite   -0.701389   0.309781  -2.264 0.023565 *  
tbsa         0.089345   0.009087   9.832  &lt; 2e-16 ***
inh_injYes   1.365277   0.361780   3.774 0.000161 ***
flameYes     0.582578   0.354493   1.643 0.100298    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 845.42  on 999  degrees of freedom
Residual deviance: 336.46  on 993  degrees of freedom
AIC: 350.46

Number of Fisher Scoring iterations: 7</code></pre>
</div>
</div>
</section>
<section id="e-interpretación-de-los-parámetros-odds-ratios" class="level2" data-number="17.3">
<h2 data-number="17.3" class="anchored" data-anchor-id="e-interpretación-de-los-parámetros-odds-ratios"><span class="header-section-number">17.3</span> e) Interpretación de los Parámetros (Odds Ratios)</h2>
<p>En un modelo logístico, los coeficientes exponenciados, <span class="math inline">\(e^{\beta_j}\)</span>, se interpretan como <strong>Odds Ratios</strong> (razón de chances).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Odds Ratios puntuales</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">coef</span>(fit1)[<span class="sc">-</span><span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       age genderMale  raceWhite       tbsa inh_injYes   flameYes 
 1.0864226  0.8175088  0.4958961  1.0934576  3.9168097  1.7906491 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Un OR &gt; 1 indica que el chance de éxito aumenta.</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Un OR &lt; 1 indica que el chance de éxito disminuye.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Cambio porcentual en los odds: (OR - 1) * 100</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>(<span class="fu">exp</span>(<span class="fu">coef</span>(fit1)[<span class="sc">-</span><span class="dv">1</span>]) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">100</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       age genderMale  raceWhite       tbsa inh_injYes   flameYes 
  8.642262 -18.249119 -50.410395   9.345756 291.680974  79.064907 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Intervalos de confianza del 95% para los Odds Ratios</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">confint</span>(fit1)[<span class="sc">-</span><span class="dv">1</span>, ])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Waiting for profiling to be done...</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>               2.5 %    97.5 %
age        1.0691824 1.1060770
genderMale 0.4486691 1.5047454
raceWhite  0.2679382 0.9063323
tbsa       1.0752625 1.1143712
inh_injYes 1.9331829 8.0230447
flameYes   0.9052347 3.6570490</code></pre>
</div>
</div>
</section>
<section id="f-elección-de-una-función-de-enlace-por-bondad-de-ajuste" class="level2" data-number="17.4">
<h2 data-number="17.4" class="anchored" data-anchor-id="f-elección-de-una-función-de-enlace-por-bondad-de-ajuste"><span class="header-section-number">17.4</span> f) Elección de una Función de Enlace por Bondad de Ajuste</h2>
<p>Se comparan cuatro funciones de enlace para la distribución binomial (<code>logit</code>, <code>probit</code>, <code>cloglog</code>, <code>cauchit</code>) utilizando los criterios de información AIC y BIC. Valores más bajos indican un mejor ajuste.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">update</span>(fit1, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="st">"probit"</span>))</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>fit3 <span class="ot">&lt;-</span> <span class="fu">update</span>(fit1, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="st">"cloglog"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>fit4 <span class="ot">&lt;-</span> <span class="fu">update</span>(fit1, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="st">"cauchit"</span>))</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Comparación de modelos</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(<span class="fu">AIC</span>(fit1, fit2, fit3, fit4), <span class="fu">BIC</span>(fit1, fit2, fit3, fit4))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     df      AIC df      BIC
fit1  7 350.4623  7 384.8166
fit2  7 347.0558  7 381.4101
fit3  7 374.6395  7 408.9938
fit4  7 389.5935  7 423.9478</code></pre>
</div>
</div>
<p><strong>Conclusión</strong>: Según AIC y BIC, el modelo <code>fit2</code> (con enlace <strong>probit</strong>) ofrece la mejor bondad de ajuste.</p>
</section>
<section id="g-h-selección-automática-del-modelo" class="level2" data-number="17.5">
<h2 data-number="17.5" class="anchored" data-anchor-id="g-h-selección-automática-del-modelo"><span class="header-section-number">17.5</span> g-h) Selección Automática del Modelo</h2>
<p>Se utiliza el método de eliminación hacia atrás (<code>backward</code>) basado en el criterio BIC para encontrar el subconjunto de predictores más parsimonioso, partiendo de un modelo con interacciones.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>fit5 <span class="ot">&lt;-</span> <span class="fu">glm</span>(death2 <span class="sc">~</span> age <span class="sc">+</span> gender <span class="sc">+</span> race <span class="sc">+</span> tbsa <span class="sc">+</span> inh_inj <span class="sc">+</span> flame <span class="sc">+</span> age<span class="sc">*</span>inh_inj <span class="sc">+</span> tbsa<span class="sc">*</span>inh_inj, </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">family =</span> <span class="fu">binomial</span>(<span class="st">"logit"</span>), <span class="at">data =</span> burn1000)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">stepCriterion</span>(fit5, <span class="at">direction =</span> <span class="st">"backward"</span>, <span class="at">criterion =</span> <span class="st">"bic"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
       Family:  binomial 
Link function:  logit 
    Criterion:  BIC 

Initial model:
~ age + gender + race + tbsa + inh_inj + flame + age * inh_inj + tbsa * inh_inj 


Step 0 :
                df    AIC    BIC adj.R-squared P(Chisq&gt;)(*)
- gender         1 327.92 367.18        0.6284     0.933130
- flame          1 330.74 370.00        0.6251     0.097426
- race           1 334.78 374.04        0.6203     0.009797
&lt;none&gt;             329.91 374.08        0.6281             
- inh_inj:tbsa   1 337.59 376.85        0.6169     0.002061
- age:inh_inj    1 351.79 391.06        0.6000     2.31e-06

Step 1 : - gender 

                df    AIC    BIC adj.R-squared P(Chisq&gt;)(*)
- flame          1 328.74 363.09        0.6255     0.097813
&lt;none&gt;             327.92 367.18        0.6284             
- race           1 332.83 367.19        0.6206     0.009622
- inh_inj:tbsa   1 335.61 369.96        0.6173     0.002051
- age:inh_inj    1 350.36 384.71        0.5997    1.643e-06

Step 2 : - flame 

                df    AIC    BIC adj.R-squared P(Chisq&gt;)(*)
- race           1 332.42 361.87        0.6191      0.01843
&lt;none&gt;             328.74 363.09        0.6255             
- inh_inj:tbsa   1 337.19 366.64        0.6134      0.00142
+ gender         1 330.74 370.00        0.6251      0.96626
- age:inh_inj    1 351.00 380.44        0.5970    1.744e-06

Step 3 : - race 

                df    AIC    BIC adj.R-squared P(Chisq&gt;)(*)
&lt;none&gt;             332.42 361.87        0.6191             
- inh_inj:tbsa   1 340.10 364.63        0.6080     0.002075
+ flame          1 332.83 367.19        0.6206     0.212331
+ gender         1 334.33 368.68        0.6188     0.758727
- age:inh_inj    1 353.46 378.00        0.5921    2.823e-06

Final model:
~ age + tbsa + inh_inj + age:inh_inj + tbsa:inh_inj 

****************************************************************************
(*) p-values of the Wald test</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>fit6 <span class="ot">&lt;-</span> <span class="fu">update</span>(fit5, <span class="at">formula. =</span> a<span class="sc">$</span>final)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit6)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = death2 ~ age + tbsa + inh_inj + age:inh_inj + tbsa:inh_inj, 
    family = binomial("logit"), data = burn1000)

Coefficients:
                 Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)     -10.31738    1.03278  -9.990  &lt; 2e-16 ***
age               0.11561    0.01352   8.553  &lt; 2e-16 ***
tbsa              0.11221    0.01439   7.797 6.36e-15 ***
inh_injYes        7.10938    1.25863   5.649 1.62e-08 ***
age:inh_injYes   -0.08004    0.01709  -4.683 2.82e-06 ***
tbsa:inh_injYes  -0.05538    0.01799  -3.079  0.00207 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 845.42  on 999  degrees of freedom
Residual deviance: 320.42  on 994  degrees of freedom
AIC: 332.42

Number of Fisher Scoring iterations: 8</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Se re-evalúan las funciones de enlace con el nuevo modelo</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>fit7 <span class="ot">&lt;-</span> <span class="fu">update</span>(fit6, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="st">"probit"</span>))</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>fit8 <span class="ot">&lt;-</span> <span class="fu">update</span>(fit6, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="st">"cloglog"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: algorithm did not converge</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>fit9 <span class="ot">&lt;-</span> <span class="fu">update</span>(fit6, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="st">"cauchit"</span>))</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(<span class="fu">AIC</span>(fit6, fit7, fit8, fit9), <span class="fu">BIC</span>(fit6, fit7, fit8, fit9))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     df      AIC df      BIC
fit6  6 332.4233  6 361.8698
fit7  6 330.5678  6 360.0143
fit8  6 342.1889  6 371.6355
fit9  6 368.4801  6 397.9266</code></pre>
</div>
</div>
<p><strong>Conclusión Final</strong>: El modelo <code>fit7</code> (con predictores seleccionados y enlace probit) es el mejor según el criterio BIC.</p>
</section>
<section id="i-validación-de-supuestos" class="level2" data-number="17.6">
<h2 data-number="17.6" class="anchored" data-anchor-id="i-validación-de-supuestos"><span class="header-section-number">17.6</span> i) Validación de Supuestos</h2>
<p>Se utilizan gráficos de diagnóstico para evaluar el ajuste del modelo final.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Gráfico de envelope para los residuales (similar a un Q-Q plot con bandas de confianza)</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">envelope</span>(fit7)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  |                               
  |                         |   0%
  |                               
  |+                        |   4%
  |                               
  |++                       |   8%
  |                               
  |+++                      |  12%
  |                               
  |++++                     |  16%
  |                               
  |+++++                    |  20%
  |                               
  |++++++                   |  24%
  |                               
  |+++++++                  |  28%
  |                               
  |++++++++                 |  32%
  |                               
  |+++++++++                |  36%
  |                               
  |++++++++++               |  40%
  |                               
  |+++++++++++              |  44%
  |                               
  |++++++++++++             |  48%
  |                               
  |+++++++++++++            |  52%
  |                               
  |++++++++++++++           |  56%
  |                               
  |+++++++++++++++          |  60%
  |                               
  |++++++++++++++++         |  64%
  |                               
  |+++++++++++++++++        |  68%
  |                               
  |++++++++++++++++++       |  72%
  |                               
  |+++++++++++++++++++      |  76%
  |                               
  |++++++++++++++++++++     |  80%
  |                               
  |+++++++++++++++++++++    |  84%
  |                               
  |++++++++++++++++++++++   |  88%
  |                               
  |+++++++++++++++++++++++  |  92%
  |                               
  |++++++++++++++++++++++++ |  96%
  |                               
  |+++++++++++++++++++++++++| 100%</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="7.-Modelos-Lineales-Generalizados---Quarto_files/figure-html/ej1-validacion-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="7.-Modelos-Lineales-Generalizados---Quarto_files/figure-html/ej1-validacion-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<hr>
</section>
</section>
<section id="ejercicio-2-predicción-del-mercado-de-valores" class="level1" data-number="18">
<h1 data-number="18"><span class="header-section-number">18</span> EJERCICIO 2: Predicción del Mercado de Valores</h1>
<p>Se utiliza el conjunto de datos <code>Smarket</code> para predecir la dirección del mercado (<code>Up</code> o <code>Down</code>).</p>
<section id="b-ajuste-del-modelo" class="level2" data-number="18.1">
<h2 data-number="18.1" class="anchored" data-anchor-id="b-ajuste-del-modelo"><span class="header-section-number">18.1</span> b) Ajuste del Modelo</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>glm.fits <span class="ot">&lt;-</span> <span class="fu">glm</span>(Direction <span class="sc">~</span> Lag1 <span class="sc">+</span> Lag2 <span class="sc">+</span> Lag3 <span class="sc">+</span> Lag4 <span class="sc">+</span> Lag5 <span class="sc">+</span> Volume,</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> Smarket, <span class="at">family =</span> binomial)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glm.fits)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = Direction ~ Lag1 + Lag2 + Lag3 + Lag4 + Lag5 + 
    Volume, family = binomial, data = Smarket)

Coefficients:
             Estimate Std. Error z value Pr(&gt;|z|)
(Intercept) -0.126000   0.240736  -0.523    0.601
Lag1        -0.073074   0.050167  -1.457    0.145
Lag2        -0.042301   0.050086  -0.845    0.398
Lag3         0.011085   0.049939   0.222    0.824
Lag4         0.009359   0.049974   0.187    0.851
Lag5         0.010313   0.049511   0.208    0.835
Volume       0.135441   0.158360   0.855    0.392

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1731.2  on 1249  degrees of freedom
Residual deviance: 1727.6  on 1243  degrees of freedom
AIC: 1741.6

Number of Fisher Scoring iterations: 3</code></pre>
</div>
</div>
</section>
<section id="c-matriz-de-confusión-con-todos-los-datos" class="level2" data-number="18.2">
<h2 data-number="18.2" class="anchored" data-anchor-id="c-matriz-de-confusión-con-todos-los-datos"><span class="header-section-number">18.2</span> c) Matriz de Confusión (con todos los datos)</h2>
<p>Se evalúa el rendimiento del modelo en los mismos datos con los que fue entrenado (esto generalmente sobreestima el rendimiento real).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>glm.probs <span class="ot">&lt;-</span> <span class="fu">predict</span>(glm.fits, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>glm.pred <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="st">"Down"</span>, <span class="fu">nrow</span>(Smarket))</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>glm.pred[glm.probs <span class="sc">&gt;</span> <span class="fl">0.5</span>] <span class="ot">&lt;-</span> <span class="st">"Up"</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Matriz de Confusión</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(Predicción <span class="ot">=</span> glm.pred, <span class="at">Real =</span> Smarket<span class="sc">$</span>Direction)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Real
Predicción Down  Up
      Down  145 141
      Up    457 507</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tasa de acierto global (Accuracy)</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(glm.pred <span class="sc">==</span> Smarket<span class="sc">$</span>Direction)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.5216</code></pre>
</div>
</div>
</section>
<section id="d-entrenamiento-y-prueba" class="level2" data-number="18.3">
<h2 data-number="18.3" class="anchored" data-anchor-id="d-entrenamiento-y-prueba"><span class="header-section-number">18.3</span> d) Entrenamiento y Prueba</h2>
<p>Un enfoque más realista es dividir los datos: entrenar el modelo con datos antiguos (hasta 2004) y probar su rendimiento en datos nuevos (2005).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> (Smarket<span class="sc">$</span>Year <span class="sc">&lt;</span> <span class="dv">2005</span>)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>Smarket<span class="fl">.2005</span> <span class="ot">&lt;-</span> Smarket[<span class="sc">!</span>train, ]</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>Direction<span class="fl">.2005</span> <span class="ot">&lt;-</span> Smarket<span class="sc">$</span>Direction[<span class="sc">!</span>train]</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>glm.fits.train <span class="ot">&lt;-</span> <span class="fu">glm</span>(Direction <span class="sc">~</span> Lag1 <span class="sc">+</span> Lag2, <span class="co"># Modelo simplificado</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> Smarket, <span class="at">family =</span> binomial, <span class="at">subset =</span> train)</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>glm.probs.test <span class="ot">&lt;-</span> <span class="fu">predict</span>(glm.fits.train, Smarket<span class="fl">.2005</span>, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>glm.pred.test <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="st">"Down"</span>, <span class="fu">nrow</span>(Smarket<span class="fl">.2005</span>))</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>glm.pred.test[glm.probs.test <span class="sc">&gt;</span> <span class="fl">0.5</span>] <span class="ot">&lt;-</span> <span class="st">"Up"</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(Predicción <span class="ot">=</span> glm.pred.test, <span class="at">Real =</span> Direction<span class="fl">.2005</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Real
Predicción Down  Up
      Down   35  35
      Up     76 106</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(glm.pred.test <span class="sc">==</span> Direction<span class="fl">.2005</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.5595238</code></pre>
</div>
</div>
<hr>
</section>
</section>
<section id="ejercicio-3-habilidad-predictiva" class="level1" data-number="19">
<h1 data-number="19"><span class="header-section-number">19</span> EJERCICIO 3: Habilidad Predictiva</h1>
<p>Se vuelve al conjunto de datos <code>burn1000</code> para realizar una evaluación predictiva más rigurosa.</p>
<section id="a-muestreo-estratificado" class="level2" data-number="19.1">
<h2 data-number="19.1" class="anchored" data-anchor-id="a-muestreo-estratificado"><span class="header-section-number">19.1</span> a) Muestreo Estratificado</h2>
<p>Dado que las clases (<code>Dead</code>/<code>Alive</code>) están desbalanceadas, se utiliza muestreo estratificado para asegurar que la proporción de clases sea la misma en los conjuntos de entrenamiento y prueba.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Se toma un 70% de cada estrato para el conjunto de entrenamiento</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>stratified <span class="ot">&lt;-</span> burn1000 <span class="sc">%&gt;%</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(death) <span class="sc">%&gt;%</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">prop =</span> <span class="fl">0.7</span>)</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="co"># El 30% restante forma el conjunto de prueba</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> burn1000[<span class="fu">setdiff</span>(burn1000<span class="sc">$</span>id, stratified<span class="sc">$</span>id), ]</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(burn1000<span class="sc">$</span>death)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Alive  Dead 
  850   150 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(stratified<span class="sc">$</span>death)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Alive  Dead 
  595   105 </code></pre>
</div>
</div>
</section>
<section id="b-entrenamiento-del-modelo-y-selección-de-variables" class="level2" data-number="19.2">
<h2 data-number="19.2" class="anchored" data-anchor-id="b-entrenamiento-del-modelo-y-selección-de-variables"><span class="header-section-number">19.2</span> b) Entrenamiento del Modelo y Selección de Variables</h2>
<p>El proceso de ajuste y selección se realiza <strong>únicamente</strong> con el conjunto de entrenamiento.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Se usa el modelo con interacciones como punto de partida</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>fit5b <span class="ot">&lt;-</span> <span class="fu">glm</span>(death2 <span class="sc">~</span> age <span class="sc">+</span> gender <span class="sc">+</span> race <span class="sc">+</span> tbsa <span class="sc">+</span> inh_inj <span class="sc">+</span> flame <span class="sc">+</span> age<span class="sc">*</span>inh_inj <span class="sc">+</span> tbsa<span class="sc">*</span>inh_inj, </span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">family =</span> <span class="fu">binomial</span>(<span class="st">"logit"</span>), <span class="at">data =</span> stratified)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">stepCriterion</span>(fit5b, <span class="at">direction =</span> <span class="st">"backward"</span>, <span class="at">criterion =</span> <span class="st">"bic"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
       Family:  binomial 
Link function:  logit 
    Criterion:  BIC 

Initial model:
~ age + gender + race + tbsa + inh_inj + flame + age * inh_inj + tbsa * inh_inj 


Step 0 :
                df    AIC    BIC adj.R-squared P(Chisq&gt;)(*)
- gender         1 232.66 269.07        0.6302     0.892068
- flame          1 238.04 274.45        0.6210     0.023533
&lt;none&gt;             234.64 275.60        0.6297             
- race           1 239.42 275.83        0.6186     0.010751
- inh_inj:tbsa   1 240.76 277.17        0.6164     0.005185
- age:inh_inj    1 253.72 290.12        0.5942    8.119e-06

Step 1 : - gender 

                df    AIC    BIC adj.R-squared P(Chisq&gt;)(*)
- flame          1 236.04 267.90        0.6215     0.023837
&lt;none&gt;             232.66 269.07        0.6302             
- race           1 237.46 269.32        0.6191     0.010725
- inh_inj:tbsa   1 238.79 270.64        0.6169     0.005162
- age:inh_inj    1 252.13 283.99        0.5941    6.321e-06

Step 2 : - flame 

                df    AIC    BIC adj.R-squared P(Chisq&gt;)(*)
- race           1 238.68 265.98        0.6142     0.033530
&lt;none&gt;             236.04 267.90        0.6215             
- inh_inj:tbsa   1 243.42 270.73        0.6061     0.002966
+ gender         1 238.04 274.45        0.6210     0.986257
- age:inh_inj    1 254.27 281.57        0.5877    9.978e-06

Step 3 : - race 

                df    AIC    BIC adj.R-squared P(Chisq&gt;)(*)
&lt;none&gt;             238.68 265.98        0.6142             
- inh_inj:tbsa   1 245.66 268.42        0.5995      0.00353
+ flame          1 237.46 269.32        0.6191      0.07887
+ gender         1 240.59 272.45        0.6138      0.76611
- age:inh_inj    1 255.86 278.62        0.5822    1.531e-05

Final model:
~ age + tbsa + inh_inj + age:inh_inj + tbsa:inh_inj 

****************************************************************************
(*) p-values of the Wald test</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>fit6b <span class="ot">&lt;-</span> <span class="fu">update</span>(fit5b, <span class="at">formula. =</span> a<span class="sc">$</span>final)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Se comparan de nuevo las funciones de enlace</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>fit7b <span class="ot">&lt;-</span> <span class="fu">update</span>(fit6b, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="st">"probit"</span>))</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>fit8b <span class="ot">&lt;-</span> <span class="fu">update</span>(fit6b, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="st">"cloglog"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: algorithm did not converge</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>fit9b <span class="ot">&lt;-</span> <span class="fu">update</span>(fit6b, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="st">"cauchit"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="c-selección-del-mejor-modelo-global-por-habilidad-predictiva" class="level2" data-number="19.3">
<h2 data-number="19.3" class="anchored" data-anchor-id="c-selección-del-mejor-modelo-global-por-habilidad-predictiva"><span class="header-section-number">19.3</span> c) Selección del Mejor Modelo Global por Habilidad Predictiva</h2>
<p>Se utilizan las <strong>Curvas ROC (Receiver Operating Characteristic)</strong> para comparar el rendimiento predictivo de los modelos en el conjunto de <strong>prueba</strong>. El área bajo la curva (AUC) es una medida global del poder discriminatorio del modelo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Se obtienen las predicciones de probabilidad para el conjunto de prueba</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>pr6b <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit6b, <span class="at">newdata =</span> test, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>pr7b <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit7b, <span class="at">newdata =</span> test, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>pr8b <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit8b, <span class="at">newdata =</span> test, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>pr9b <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit9b, <span class="at">newdata =</span> test, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Se comparan las curvas ROC</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>testres <span class="ot">&lt;-</span> test<span class="sc">$</span>death2</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ROCc</span>(<span class="fu">cbind</span>(testres, pr6b), <span class="at">main=</span><span class="st">"Modelo 6 (logit)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 Area Under ROC Curve  =  0.968,   95% CI: (0.949, 0.987) 
     Gini Coefficient  =  0.936,   95% CI: (0.898, 0.974) 
        K-S Statistic  =  0.834 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ROCc</span>(<span class="fu">cbind</span>(testres, pr7b), <span class="at">main=</span><span class="st">"Modelo 7 (probit)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 Area Under ROC Curve  =  0.968,   95% CI: (0.949, 0.987) 
     Gini Coefficient  =  0.936,   95% CI: (0.898, 0.974) 
        K-S Statistic  =  0.83 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ROCc</span>(<span class="fu">cbind</span>(testres, pr8b), <span class="at">main=</span><span class="st">"Modelo 8 (cloglog)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 Area Under ROC Curve  =  0.969,   95% CI: (0.95, 0.987) 
     Gini Coefficient  =  0.937,   95% CI: (0.9, 0.974) 
        K-S Statistic  =  0.816 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ROCc</span>(<span class="fu">cbind</span>(testres, pr9b), <span class="at">main=</span><span class="st">"Modelo 9 (cauchit)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 Area Under ROC Curve  =  0.966,   95% CI: (0.946, 0.986) 
     Gini Coefficient  =  0.933,   95% CI: (0.893, 0.972) 
        K-S Statistic  =  0.838 </code></pre>
</div>
</div>
<p><strong>Conclusión</strong>: Se elige el modelo con el AUC más alto (en este caso, <code>fit7b</code>).</p>
</section>
<section id="elección-del-punto-de-corte-tau-óptimo" class="level2" data-number="19.4">
<h2 data-number="19.4" class="anchored" data-anchor-id="elección-del-punto-de-corte-tau-óptimo"><span class="header-section-number">19.4</span> Elección del Punto de Corte (<code>tau</code>) Óptimo</h2>
<p>Una vez elegido el mejor modelo (<code>fit7b</code>), se debe seleccionar un punto de corte (<code>tau</code>) para convertir las probabilidades predichas en clasificaciones (“Dead” / “Alive”). La elección de <code>tau</code> depende del objetivo (minimizar errores, maximizar precisión, etc.).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>tau <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>, <span class="at">by =</span> <span class="fl">0.05</span>)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>AER <span class="ot">&lt;-</span> recall <span class="ot">&lt;-</span> precision <span class="ot">&lt;-</span> F1 <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>exito <span class="ot">&lt;-</span> <span class="st">"1"</span>; frac <span class="ot">&lt;-</span> <span class="st">"0"</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(tau)){</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>    glm.pred <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="st">"0"</span>, <span class="fu">length</span>(testres))</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>    glm.pred[pr7b <span class="sc">&gt;</span> tau[i]] <span class="ot">&lt;-</span> <span class="st">"1"</span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>    tab<span class="ot">&lt;-</span><span class="fu">table</span>(glm.pred, testres)</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span>frac <span class="sc">%in%</span> <span class="fu">rownames</span>(tab)){</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>      tab<span class="ot">&lt;-</span><span class="fu">rbind</span>(tab,<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))</span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rownames</span>(tab)[<span class="dv">2</span>]<span class="ot">&lt;-</span>frac</span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>    } </span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span>exito <span class="sc">%in%</span> <span class="fu">rownames</span>(tab)){</span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>      tab<span class="ot">&lt;-</span><span class="fu">rbind</span>(tab,<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))</span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rownames</span>(tab)[<span class="dv">2</span>]<span class="ot">&lt;-</span>exito</span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a>    AER[i]<span class="ot">&lt;-</span>(tab[exito,frac]<span class="sc">+</span>tab[frac,exito])<span class="sc">/</span><span class="fu">sum</span>(tab)</span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a>    precision[i]<span class="ot">&lt;-</span>(tab[exito,exito])<span class="sc">/</span><span class="fu">sum</span>(tab[exito,])</span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true" tabindex="-1"></a>    recall[i]<span class="ot">&lt;-</span>(tab[exito,exito])<span class="sc">/</span><span class="fu">sum</span>(tab[,exito])</span>
<span id="cb58-20"><a href="#cb58-20" aria-hidden="true" tabindex="-1"></a>    F1[i]<span class="ot">&lt;-</span><span class="dv">2</span><span class="sc">*</span>precision[i]<span class="sc">*</span>recall[i]<span class="sc">/</span>(precision[i]<span class="sc">+</span>recall[i])</span>
<span id="cb58-21"><a href="#cb58-21" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb58-22"><a href="#cb58-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-23"><a href="#cb58-23" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(tau,AER,precision,recall,F1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       tau        AER precision    recall        F1
 [1,] 0.10 0.14000000 0.5180723 0.9555556 0.6718750
 [2,] 0.15 0.11666667 0.5694444 0.9111111 0.7008547
 [3,] 0.20 0.10333333 0.6060606 0.8888889 0.7207207
 [4,] 0.25 0.07666667 0.7115385 0.8222222 0.7628866
 [5,] 0.30 0.07666667 0.7200000 0.8000000 0.7578947
 [6,] 0.35 0.07000000 0.7608696 0.7777778 0.7692308
 [7,] 0.40 0.06333333 0.8250000 0.7333333 0.7764706
 [8,] 0.45 0.06333333 0.8421053 0.7111111 0.7710843
 [9,] 0.50 0.06666667 0.8571429 0.6666667 0.7500000
[10,] 0.55 0.07000000 0.8529412 0.6444444 0.7341772
[11,] 0.60 0.07666667 0.8666667 0.5777778 0.6933333
[12,] 0.65 0.09000000 0.8461538 0.4888889 0.6197183
[13,] 0.70 0.08666667 0.9130435 0.4666667 0.6176471
[14,] 0.75 0.09333333 0.9047619 0.4222222 0.5757576
[15,] 0.80 0.09333333 1.0000000 0.3777778 0.5483871
[16,] 0.85 0.10000000 1.0000000 0.3333333 0.5000000
[17,] 0.90 0.12000000 1.0000000 0.2000000 0.3333333</code></pre>
</div>
</div>
<p><strong>Análisis</strong>: Para elegir el <code>tau</code> óptimo, se busca un equilibrio. La métrica <strong>F1</strong>, que es la media armónica de la precisión y el recall, es una excelente opción para datos desbalanceados. El <code>tau</code> que maximiza F1 sería una buena elección.</p>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../CONTENIDO/SESIONES DE R DE CLASE/6. Modelos Generalizados Aditivos - Quarto.html" class="pagination-link" aria-label="Modelos Generalizados Aditivos">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Modelos Generalizados Aditivos</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb60" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Modelos Lineales Generalizados GAM"</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Brayan Cubides"</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="an">toc:</span><span class="co"> true</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="an">toc-location:</span><span class="co"> right</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a><span class="an">toc-depth:</span><span class="co"> 2</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a><span class="co">#number-sections: true</span></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a><span class="an">code-tools:</span><span class="co"> true</span></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a><span class="an">lightbox:</span><span class="co"> true</span></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a><span class="an">self-contained:</span><span class="co"> false </span></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a><span class="fu"># Introducción</span></span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>Este documento explora los **Modelos Lineales Generalizados (GLM)**, con un enfoque en la regresión logística para variables de respuesta binarias. Se divide en tres ejercicios principales:</span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>**Ejercicio 1**: Se ajusta un modelo logístico, se interpretan sus coeficientes, se comparan diferentes funciones de enlace y se realiza una selección automática de variables.</span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>**Ejercicio 2**: Se aplica la regresión logística para predecir la dirección del mercado de valores, introduciendo el concepto de dividir los datos en conjuntos de entrenamiento y prueba.</span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-21"><a href="#cb60-21" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>**Ejercicio 3**: Se profundiza en la evaluación de la **habilidad predictiva** del modelo, utilizando muestreo estratificado, curvas ROC, y la optimización de un punto de corte (<span class="in">`tau`</span>) para la clasificación.</span>
<span id="cb60-22"><a href="#cb60-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-23"><a href="#cb60-23" aria-hidden="true" tabindex="-1"></a><span class="fu">### Librerías Requeridas</span></span>
<span id="cb60-24"><a href="#cb60-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-27"><a href="#cb60-27" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb60-28"><a href="#cb60-28" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: setup</span></span>
<span id="cb60-29"><a href="#cb60-29" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb60-30"><a href="#cb60-30" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb60-31"><a href="#cb60-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-32"><a href="#cb60-32" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb60-33"><a href="#cb60-33" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb60-34"><a href="#cb60-34" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmtoolbox) <span class="co"># Para stepCriterion() y envelope()</span></span>
<span id="cb60-35"><a href="#cb60-35" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(aplore3)    <span class="co"># Para el dataset burn1000</span></span>
<span id="cb60-36"><a href="#cb60-36" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ISLR2)      <span class="co"># Para el dataset Smarket</span></span>
<span id="cb60-37"><a href="#cb60-37" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-38"><a href="#cb60-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-39"><a href="#cb60-39" aria-hidden="true" tabindex="-1"></a><span class="fu"># EJERCICIO 1: Bondad de Ajuste en Regresión Logística</span></span>
<span id="cb60-40"><a href="#cb60-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-41"><a href="#cb60-41" aria-hidden="true" tabindex="-1"></a>Se utiliza el conjunto de datos <span class="in">`burn1000`</span> para modelar la probabilidad de muerte (<span class="in">`death`</span>) en función de varios factores de riesgo.</span>
<span id="cb60-42"><a href="#cb60-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-43"><a href="#cb60-43" aria-hidden="true" tabindex="-1"></a><span class="fu">## a) Análisis de Estadística Descriptiva</span></span>
<span id="cb60-44"><a href="#cb60-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-47"><a href="#cb60-47" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb60-48"><a href="#cb60-48" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: ej1-datos</span></span>
<span id="cb60-49"><a href="#cb60-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-50"><a href="#cb60-50" aria-hidden="true" tabindex="-1"></a>burn1000 <span class="ot">&lt;-</span> aplore3<span class="sc">::</span>burn1000</span>
<span id="cb60-51"><a href="#cb60-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Se crea la variable de respuesta binaria: 1 = "Dead" (éxito), 0 = "Alive"</span></span>
<span id="cb60-52"><a href="#cb60-52" aria-hidden="true" tabindex="-1"></a>burn1000 <span class="ot">&lt;-</span> <span class="fu">within</span>(burn1000, death2 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(death <span class="sc">==</span> <span class="st">"Dead"</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb60-53"><a href="#cb60-53" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(burn1000)</span>
<span id="cb60-54"><a href="#cb60-54" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(burn1000)</span>
<span id="cb60-55"><a href="#cb60-55" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-56"><a href="#cb60-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-57"><a href="#cb60-57" aria-hidden="true" tabindex="-1"></a><span class="fu">## b-d) Ajuste de un Primer Modelo Logístico</span></span>
<span id="cb60-58"><a href="#cb60-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-59"><a href="#cb60-59" aria-hidden="true" tabindex="-1"></a>Se ajusta un GLM con una distribución <span class="in">`binomial`</span> y una función de enlace <span class="in">`logit`</span>. El modelo es:</span>
<span id="cb60-60"><a href="#cb60-60" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb60-61"><a href="#cb60-61" aria-hidden="true" tabindex="-1"></a>\log\left(\frac{p_i}{1-p_i}\right) = \beta_0 + \beta_1 x_{i1} + \dots + \beta_k x_{ik}</span>
<span id="cb60-62"><a href="#cb60-62" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb60-63"><a href="#cb60-63" aria-hidden="true" tabindex="-1"></a>donde $p_i$ es la probabilidad de "éxito" (muerte) para el individuo $i$.</span>
<span id="cb60-64"><a href="#cb60-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-67"><a href="#cb60-67" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb60-68"><a href="#cb60-68" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: ej1-modelo</span></span>
<span id="cb60-69"><a href="#cb60-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-70"><a href="#cb60-70" aria-hidden="true" tabindex="-1"></a><span class="co"># Definir el Modelo Lineal Generalizado</span></span>
<span id="cb60-71"><a href="#cb60-71" aria-hidden="true" tabindex="-1"></a>fit1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(death2 <span class="sc">~</span> age <span class="sc">+</span> gender <span class="sc">+</span> race <span class="sc">+</span> tbsa <span class="sc">+</span> inh_inj <span class="sc">+</span> flame, </span>
<span id="cb60-72"><a href="#cb60-72" aria-hidden="true" tabindex="-1"></a>            <span class="at">family =</span> <span class="fu">binomial</span>(<span class="st">"logit"</span>), <span class="at">data =</span> burn1000)</span>
<span id="cb60-73"><a href="#cb60-73" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit1)</span>
<span id="cb60-74"><a href="#cb60-74" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-75"><a href="#cb60-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-76"><a href="#cb60-76" aria-hidden="true" tabindex="-1"></a><span class="fu">## e) Interpretación de los Parámetros (Odds Ratios)</span></span>
<span id="cb60-77"><a href="#cb60-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-78"><a href="#cb60-78" aria-hidden="true" tabindex="-1"></a>En un modelo logístico, los coeficientes exponenciados, $e^{\beta_j}$, se interpretan como **Odds Ratios** (razón de chances).</span>
<span id="cb60-79"><a href="#cb60-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-82"><a href="#cb60-82" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb60-83"><a href="#cb60-83" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: ej1-interpretacion</span></span>
<span id="cb60-84"><a href="#cb60-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-85"><a href="#cb60-85" aria-hidden="true" tabindex="-1"></a><span class="co"># Odds Ratios puntuales</span></span>
<span id="cb60-86"><a href="#cb60-86" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">coef</span>(fit1)[<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb60-87"><a href="#cb60-87" aria-hidden="true" tabindex="-1"></a><span class="co"># Un OR &gt; 1 indica que el chance de éxito aumenta.</span></span>
<span id="cb60-88"><a href="#cb60-88" aria-hidden="true" tabindex="-1"></a><span class="co"># Un OR &lt; 1 indica que el chance de éxito disminuye.</span></span>
<span id="cb60-89"><a href="#cb60-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-90"><a href="#cb60-90" aria-hidden="true" tabindex="-1"></a><span class="co"># Cambio porcentual en los odds: (OR - 1) * 100</span></span>
<span id="cb60-91"><a href="#cb60-91" aria-hidden="true" tabindex="-1"></a>(<span class="fu">exp</span>(<span class="fu">coef</span>(fit1)[<span class="sc">-</span><span class="dv">1</span>]) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb60-92"><a href="#cb60-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-93"><a href="#cb60-93" aria-hidden="true" tabindex="-1"></a><span class="co"># Intervalos de confianza del 95% para los Odds Ratios</span></span>
<span id="cb60-94"><a href="#cb60-94" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">confint</span>(fit1)[<span class="sc">-</span><span class="dv">1</span>, ])</span>
<span id="cb60-95"><a href="#cb60-95" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-96"><a href="#cb60-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-97"><a href="#cb60-97" aria-hidden="true" tabindex="-1"></a><span class="fu">## f) Elección de una Función de Enlace por Bondad de Ajuste</span></span>
<span id="cb60-98"><a href="#cb60-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-99"><a href="#cb60-99" aria-hidden="true" tabindex="-1"></a>Se comparan cuatro funciones de enlace para la distribución binomial (<span class="in">`logit`</span>, <span class="in">`probit`</span>, <span class="in">`cloglog`</span>, <span class="in">`cauchit`</span>) utilizando los criterios de información AIC y BIC. Valores más bajos indican un mejor ajuste.</span>
<span id="cb60-100"><a href="#cb60-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-103"><a href="#cb60-103" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb60-104"><a href="#cb60-104" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: ej1-enlace</span></span>
<span id="cb60-105"><a href="#cb60-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-106"><a href="#cb60-106" aria-hidden="true" tabindex="-1"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">update</span>(fit1, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="st">"probit"</span>))</span>
<span id="cb60-107"><a href="#cb60-107" aria-hidden="true" tabindex="-1"></a>fit3 <span class="ot">&lt;-</span> <span class="fu">update</span>(fit1, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="st">"cloglog"</span>))</span>
<span id="cb60-108"><a href="#cb60-108" aria-hidden="true" tabindex="-1"></a>fit4 <span class="ot">&lt;-</span> <span class="fu">update</span>(fit1, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="st">"cauchit"</span>))</span>
<span id="cb60-109"><a href="#cb60-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-110"><a href="#cb60-110" aria-hidden="true" tabindex="-1"></a><span class="co"># Comparación de modelos</span></span>
<span id="cb60-111"><a href="#cb60-111" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(<span class="fu">AIC</span>(fit1, fit2, fit3, fit4), <span class="fu">BIC</span>(fit1, fit2, fit3, fit4))</span>
<span id="cb60-112"><a href="#cb60-112" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-113"><a href="#cb60-113" aria-hidden="true" tabindex="-1"></a>**Conclusión**: Según AIC y BIC, el modelo `fit2` (con enlace **probit**) ofrece la mejor bondad de ajuste.</span>
<span id="cb60-114"><a href="#cb60-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-115"><a href="#cb60-115" aria-hidden="true" tabindex="-1"></a><span class="fu">## g-h) Selección Automática del Modelo</span></span>
<span id="cb60-116"><a href="#cb60-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-117"><a href="#cb60-117" aria-hidden="true" tabindex="-1"></a>Se utiliza el método de eliminación hacia atrás (<span class="in">`backward`</span>) basado en el criterio BIC para encontrar el subconjunto de predictores más parsimonioso, partiendo de un modelo con interacciones.</span>
<span id="cb60-118"><a href="#cb60-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-121"><a href="#cb60-121" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb60-122"><a href="#cb60-122" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: ej1-seleccion-variables</span></span>
<span id="cb60-123"><a href="#cb60-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-124"><a href="#cb60-124" aria-hidden="true" tabindex="-1"></a>fit5 <span class="ot">&lt;-</span> <span class="fu">glm</span>(death2 <span class="sc">~</span> age <span class="sc">+</span> gender <span class="sc">+</span> race <span class="sc">+</span> tbsa <span class="sc">+</span> inh_inj <span class="sc">+</span> flame <span class="sc">+</span> age<span class="sc">*</span>inh_inj <span class="sc">+</span> tbsa<span class="sc">*</span>inh_inj, </span>
<span id="cb60-125"><a href="#cb60-125" aria-hidden="true" tabindex="-1"></a>            <span class="at">family =</span> <span class="fu">binomial</span>(<span class="st">"logit"</span>), <span class="at">data =</span> burn1000)</span>
<span id="cb60-126"><a href="#cb60-126" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">stepCriterion</span>(fit5, <span class="at">direction =</span> <span class="st">"backward"</span>, <span class="at">criterion =</span> <span class="st">"bic"</span>)</span>
<span id="cb60-127"><a href="#cb60-127" aria-hidden="true" tabindex="-1"></a>fit6 <span class="ot">&lt;-</span> <span class="fu">update</span>(fit5, <span class="at">formula. =</span> a<span class="sc">$</span>final)</span>
<span id="cb60-128"><a href="#cb60-128" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit6)</span>
<span id="cb60-129"><a href="#cb60-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-130"><a href="#cb60-130" aria-hidden="true" tabindex="-1"></a><span class="co"># Se re-evalúan las funciones de enlace con el nuevo modelo</span></span>
<span id="cb60-131"><a href="#cb60-131" aria-hidden="true" tabindex="-1"></a>fit7 <span class="ot">&lt;-</span> <span class="fu">update</span>(fit6, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="st">"probit"</span>))</span>
<span id="cb60-132"><a href="#cb60-132" aria-hidden="true" tabindex="-1"></a>fit8 <span class="ot">&lt;-</span> <span class="fu">update</span>(fit6, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="st">"cloglog"</span>))</span>
<span id="cb60-133"><a href="#cb60-133" aria-hidden="true" tabindex="-1"></a>fit9 <span class="ot">&lt;-</span> <span class="fu">update</span>(fit6, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="st">"cauchit"</span>))</span>
<span id="cb60-134"><a href="#cb60-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-135"><a href="#cb60-135" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(<span class="fu">AIC</span>(fit6, fit7, fit8, fit9), <span class="fu">BIC</span>(fit6, fit7, fit8, fit9))</span>
<span id="cb60-136"><a href="#cb60-136" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-137"><a href="#cb60-137" aria-hidden="true" tabindex="-1"></a>**Conclusión Final**: El modelo <span class="in">`fit7`</span> (con predictores seleccionados y enlace probit) es el mejor según el criterio BIC.</span>
<span id="cb60-138"><a href="#cb60-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-139"><a href="#cb60-139" aria-hidden="true" tabindex="-1"></a><span class="fu">## i) Validación de Supuestos</span></span>
<span id="cb60-140"><a href="#cb60-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-141"><a href="#cb60-141" aria-hidden="true" tabindex="-1"></a>Se utilizan gráficos de diagnóstico para evaluar el ajuste del modelo final.</span>
<span id="cb60-142"><a href="#cb60-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-145"><a href="#cb60-145" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb60-146"><a href="#cb60-146" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: ej1-validacion</span></span>
<span id="cb60-147"><a href="#cb60-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-148"><a href="#cb60-148" aria-hidden="true" tabindex="-1"></a><span class="co"># Gráfico de envelope para los residuales (similar a un Q-Q plot con bandas de confianza)</span></span>
<span id="cb60-149"><a href="#cb60-149" aria-hidden="true" tabindex="-1"></a><span class="fu">envelope</span>(fit7)</span>
<span id="cb60-150"><a href="#cb60-150" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-151"><a href="#cb60-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-152"><a href="#cb60-152" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb60-153"><a href="#cb60-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-154"><a href="#cb60-154" aria-hidden="true" tabindex="-1"></a><span class="fu"># EJERCICIO 2: Predicción del Mercado de Valores</span></span>
<span id="cb60-155"><a href="#cb60-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-156"><a href="#cb60-156" aria-hidden="true" tabindex="-1"></a>Se utiliza el conjunto de datos <span class="in">`Smarket`</span> para predecir la dirección del mercado (<span class="in">`Up`</span> o <span class="in">`Down`</span>).</span>
<span id="cb60-157"><a href="#cb60-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-158"><a href="#cb60-158" aria-hidden="true" tabindex="-1"></a><span class="fu">## b) Ajuste del Modelo</span></span>
<span id="cb60-159"><a href="#cb60-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-162"><a href="#cb60-162" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb60-163"><a href="#cb60-163" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: ej2-modelo</span></span>
<span id="cb60-164"><a href="#cb60-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-165"><a href="#cb60-165" aria-hidden="true" tabindex="-1"></a>glm.fits <span class="ot">&lt;-</span> <span class="fu">glm</span>(Direction <span class="sc">~</span> Lag1 <span class="sc">+</span> Lag2 <span class="sc">+</span> Lag3 <span class="sc">+</span> Lag4 <span class="sc">+</span> Lag5 <span class="sc">+</span> Volume,</span>
<span id="cb60-166"><a href="#cb60-166" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> Smarket, <span class="at">family =</span> binomial)</span>
<span id="cb60-167"><a href="#cb60-167" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glm.fits)</span>
<span id="cb60-168"><a href="#cb60-168" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-169"><a href="#cb60-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-170"><a href="#cb60-170" aria-hidden="true" tabindex="-1"></a><span class="fu">## c) Matriz de Confusión (con todos los datos)</span></span>
<span id="cb60-171"><a href="#cb60-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-172"><a href="#cb60-172" aria-hidden="true" tabindex="-1"></a>Se evalúa el rendimiento del modelo en los mismos datos con los que fue entrenado (esto generalmente sobreestima el rendimiento real).</span>
<span id="cb60-173"><a href="#cb60-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-176"><a href="#cb60-176" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb60-177"><a href="#cb60-177" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: ej2-matriz-confusion</span></span>
<span id="cb60-178"><a href="#cb60-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-179"><a href="#cb60-179" aria-hidden="true" tabindex="-1"></a>glm.probs <span class="ot">&lt;-</span> <span class="fu">predict</span>(glm.fits, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb60-180"><a href="#cb60-180" aria-hidden="true" tabindex="-1"></a>glm.pred <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="st">"Down"</span>, <span class="fu">nrow</span>(Smarket))</span>
<span id="cb60-181"><a href="#cb60-181" aria-hidden="true" tabindex="-1"></a>glm.pred[glm.probs <span class="sc">&gt;</span> <span class="fl">0.5</span>] <span class="ot">&lt;-</span> <span class="st">"Up"</span></span>
<span id="cb60-182"><a href="#cb60-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-183"><a href="#cb60-183" aria-hidden="true" tabindex="-1"></a><span class="co"># Matriz de Confusión</span></span>
<span id="cb60-184"><a href="#cb60-184" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(Predicción <span class="ot">=</span> glm.pred, <span class="at">Real =</span> Smarket<span class="sc">$</span>Direction)</span>
<span id="cb60-185"><a href="#cb60-185" aria-hidden="true" tabindex="-1"></a><span class="co"># Tasa de acierto global (Accuracy)</span></span>
<span id="cb60-186"><a href="#cb60-186" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(glm.pred <span class="sc">==</span> Smarket<span class="sc">$</span>Direction)</span>
<span id="cb60-187"><a href="#cb60-187" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-188"><a href="#cb60-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-189"><a href="#cb60-189" aria-hidden="true" tabindex="-1"></a><span class="fu">## d) Entrenamiento y Prueba</span></span>
<span id="cb60-190"><a href="#cb60-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-191"><a href="#cb60-191" aria-hidden="true" tabindex="-1"></a>Un enfoque más realista es dividir los datos: entrenar el modelo con datos antiguos (hasta 2004) y probar su rendimiento en datos nuevos (2005).</span>
<span id="cb60-192"><a href="#cb60-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-195"><a href="#cb60-195" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb60-196"><a href="#cb60-196" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: ej2-train-test</span></span>
<span id="cb60-197"><a href="#cb60-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-198"><a href="#cb60-198" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> (Smarket<span class="sc">$</span>Year <span class="sc">&lt;</span> <span class="dv">2005</span>)</span>
<span id="cb60-199"><a href="#cb60-199" aria-hidden="true" tabindex="-1"></a>Smarket<span class="fl">.2005</span> <span class="ot">&lt;-</span> Smarket[<span class="sc">!</span>train, ]</span>
<span id="cb60-200"><a href="#cb60-200" aria-hidden="true" tabindex="-1"></a>Direction<span class="fl">.2005</span> <span class="ot">&lt;-</span> Smarket<span class="sc">$</span>Direction[<span class="sc">!</span>train]</span>
<span id="cb60-201"><a href="#cb60-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-202"><a href="#cb60-202" aria-hidden="true" tabindex="-1"></a>glm.fits.train <span class="ot">&lt;-</span> <span class="fu">glm</span>(Direction <span class="sc">~</span> Lag1 <span class="sc">+</span> Lag2, <span class="co"># Modelo simplificado</span></span>
<span id="cb60-203"><a href="#cb60-203" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> Smarket, <span class="at">family =</span> binomial, <span class="at">subset =</span> train)</span>
<span id="cb60-204"><a href="#cb60-204" aria-hidden="true" tabindex="-1"></a>glm.probs.test <span class="ot">&lt;-</span> <span class="fu">predict</span>(glm.fits.train, Smarket<span class="fl">.2005</span>, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb60-205"><a href="#cb60-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-206"><a href="#cb60-206" aria-hidden="true" tabindex="-1"></a>glm.pred.test <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="st">"Down"</span>, <span class="fu">nrow</span>(Smarket<span class="fl">.2005</span>))</span>
<span id="cb60-207"><a href="#cb60-207" aria-hidden="true" tabindex="-1"></a>glm.pred.test[glm.probs.test <span class="sc">&gt;</span> <span class="fl">0.5</span>] <span class="ot">&lt;-</span> <span class="st">"Up"</span></span>
<span id="cb60-208"><a href="#cb60-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-209"><a href="#cb60-209" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(Predicción <span class="ot">=</span> glm.pred.test, <span class="at">Real =</span> Direction<span class="fl">.2005</span>)</span>
<span id="cb60-210"><a href="#cb60-210" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(glm.pred.test <span class="sc">==</span> Direction<span class="fl">.2005</span>)</span>
<span id="cb60-211"><a href="#cb60-211" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-212"><a href="#cb60-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-213"><a href="#cb60-213" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb60-214"><a href="#cb60-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-215"><a href="#cb60-215" aria-hidden="true" tabindex="-1"></a><span class="fu"># EJERCICIO 3: Habilidad Predictiva</span></span>
<span id="cb60-216"><a href="#cb60-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-217"><a href="#cb60-217" aria-hidden="true" tabindex="-1"></a>Se vuelve al conjunto de datos <span class="in">`burn1000`</span> para realizar una evaluación predictiva más rigurosa.</span>
<span id="cb60-218"><a href="#cb60-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-219"><a href="#cb60-219" aria-hidden="true" tabindex="-1"></a><span class="fu">## a) Muestreo Estratificado</span></span>
<span id="cb60-220"><a href="#cb60-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-221"><a href="#cb60-221" aria-hidden="true" tabindex="-1"></a>Dado que las clases (<span class="in">`Dead`</span>/<span class="in">`Alive`</span>) están desbalanceadas, se utiliza muestreo estratificado para asegurar que la proporción de clases sea la misma en los conjuntos de entrenamiento y prueba.</span>
<span id="cb60-222"><a href="#cb60-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-225"><a href="#cb60-225" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb60-226"><a href="#cb60-226" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: ej3-muestreo</span></span>
<span id="cb60-227"><a href="#cb60-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-228"><a href="#cb60-228" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb60-229"><a href="#cb60-229" aria-hidden="true" tabindex="-1"></a><span class="co"># Se toma un 70% de cada estrato para el conjunto de entrenamiento</span></span>
<span id="cb60-230"><a href="#cb60-230" aria-hidden="true" tabindex="-1"></a>stratified <span class="ot">&lt;-</span> burn1000 <span class="sc">%&gt;%</span></span>
<span id="cb60-231"><a href="#cb60-231" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(death) <span class="sc">%&gt;%</span></span>
<span id="cb60-232"><a href="#cb60-232" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">prop =</span> <span class="fl">0.7</span>)</span>
<span id="cb60-233"><a href="#cb60-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-234"><a href="#cb60-234" aria-hidden="true" tabindex="-1"></a><span class="co"># El 30% restante forma el conjunto de prueba</span></span>
<span id="cb60-235"><a href="#cb60-235" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> burn1000[<span class="fu">setdiff</span>(burn1000<span class="sc">$</span>id, stratified<span class="sc">$</span>id), ]</span>
<span id="cb60-236"><a href="#cb60-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-237"><a href="#cb60-237" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(burn1000<span class="sc">$</span>death)</span>
<span id="cb60-238"><a href="#cb60-238" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(stratified<span class="sc">$</span>death)</span>
<span id="cb60-239"><a href="#cb60-239" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-240"><a href="#cb60-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-241"><a href="#cb60-241" aria-hidden="true" tabindex="-1"></a><span class="fu">## b) Entrenamiento del Modelo y Selección de Variables</span></span>
<span id="cb60-242"><a href="#cb60-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-243"><a href="#cb60-243" aria-hidden="true" tabindex="-1"></a>El proceso de ajuste y selección se realiza **únicamente** con el conjunto de entrenamiento.</span>
<span id="cb60-244"><a href="#cb60-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-247"><a href="#cb60-247" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb60-248"><a href="#cb60-248" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: ej3-entrenamiento</span></span>
<span id="cb60-249"><a href="#cb60-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-250"><a href="#cb60-250" aria-hidden="true" tabindex="-1"></a><span class="co"># Se usa el modelo con interacciones como punto de partida</span></span>
<span id="cb60-251"><a href="#cb60-251" aria-hidden="true" tabindex="-1"></a>fit5b <span class="ot">&lt;-</span> <span class="fu">glm</span>(death2 <span class="sc">~</span> age <span class="sc">+</span> gender <span class="sc">+</span> race <span class="sc">+</span> tbsa <span class="sc">+</span> inh_inj <span class="sc">+</span> flame <span class="sc">+</span> age<span class="sc">*</span>inh_inj <span class="sc">+</span> tbsa<span class="sc">*</span>inh_inj, </span>
<span id="cb60-252"><a href="#cb60-252" aria-hidden="true" tabindex="-1"></a>             <span class="at">family =</span> <span class="fu">binomial</span>(<span class="st">"logit"</span>), <span class="at">data =</span> stratified)</span>
<span id="cb60-253"><a href="#cb60-253" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">stepCriterion</span>(fit5b, <span class="at">direction =</span> <span class="st">"backward"</span>, <span class="at">criterion =</span> <span class="st">"bic"</span>)</span>
<span id="cb60-254"><a href="#cb60-254" aria-hidden="true" tabindex="-1"></a>fit6b <span class="ot">&lt;-</span> <span class="fu">update</span>(fit5b, <span class="at">formula. =</span> a<span class="sc">$</span>final)</span>
<span id="cb60-255"><a href="#cb60-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-256"><a href="#cb60-256" aria-hidden="true" tabindex="-1"></a><span class="co"># Se comparan de nuevo las funciones de enlace</span></span>
<span id="cb60-257"><a href="#cb60-257" aria-hidden="true" tabindex="-1"></a>fit7b <span class="ot">&lt;-</span> <span class="fu">update</span>(fit6b, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="st">"probit"</span>))</span>
<span id="cb60-258"><a href="#cb60-258" aria-hidden="true" tabindex="-1"></a>fit8b <span class="ot">&lt;-</span> <span class="fu">update</span>(fit6b, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="st">"cloglog"</span>))</span>
<span id="cb60-259"><a href="#cb60-259" aria-hidden="true" tabindex="-1"></a>fit9b <span class="ot">&lt;-</span> <span class="fu">update</span>(fit6b, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="st">"cauchit"</span>))</span>
<span id="cb60-260"><a href="#cb60-260" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-261"><a href="#cb60-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-262"><a href="#cb60-262" aria-hidden="true" tabindex="-1"></a><span class="fu">## c) Selección del Mejor Modelo Global por Habilidad Predictiva</span></span>
<span id="cb60-263"><a href="#cb60-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-264"><a href="#cb60-264" aria-hidden="true" tabindex="-1"></a>Se utilizan las **Curvas ROC (Receiver Operating Characteristic)** para comparar el rendimiento predictivo de los modelos en el conjunto de **prueba**. El área bajo la curva (AUC) es una medida global del poder discriminatorio del modelo.</span>
<span id="cb60-265"><a href="#cb60-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-268"><a href="#cb60-268" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb60-269"><a href="#cb60-269" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: ej3-roc</span></span>
<span id="cb60-270"><a href="#cb60-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-271"><a href="#cb60-271" aria-hidden="true" tabindex="-1"></a><span class="co"># Se obtienen las predicciones de probabilidad para el conjunto de prueba</span></span>
<span id="cb60-272"><a href="#cb60-272" aria-hidden="true" tabindex="-1"></a>pr6b <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit6b, <span class="at">newdata =</span> test, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb60-273"><a href="#cb60-273" aria-hidden="true" tabindex="-1"></a>pr7b <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit7b, <span class="at">newdata =</span> test, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb60-274"><a href="#cb60-274" aria-hidden="true" tabindex="-1"></a>pr8b <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit8b, <span class="at">newdata =</span> test, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb60-275"><a href="#cb60-275" aria-hidden="true" tabindex="-1"></a>pr9b <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit9b, <span class="at">newdata =</span> test, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb60-276"><a href="#cb60-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-277"><a href="#cb60-277" aria-hidden="true" tabindex="-1"></a><span class="co"># Se comparan las curvas ROC</span></span>
<span id="cb60-278"><a href="#cb60-278" aria-hidden="true" tabindex="-1"></a>testres <span class="ot">&lt;-</span> test<span class="sc">$</span>death2</span>
<span id="cb60-279"><a href="#cb60-279" aria-hidden="true" tabindex="-1"></a><span class="fu">ROCc</span>(<span class="fu">cbind</span>(testres, pr6b), <span class="at">main=</span><span class="st">"Modelo 6 (logit)"</span>)</span>
<span id="cb60-280"><a href="#cb60-280" aria-hidden="true" tabindex="-1"></a><span class="fu">ROCc</span>(<span class="fu">cbind</span>(testres, pr7b), <span class="at">main=</span><span class="st">"Modelo 7 (probit)"</span>)</span>
<span id="cb60-281"><a href="#cb60-281" aria-hidden="true" tabindex="-1"></a><span class="fu">ROCc</span>(<span class="fu">cbind</span>(testres, pr8b), <span class="at">main=</span><span class="st">"Modelo 8 (cloglog)"</span>)</span>
<span id="cb60-282"><a href="#cb60-282" aria-hidden="true" tabindex="-1"></a><span class="fu">ROCc</span>(<span class="fu">cbind</span>(testres, pr9b), <span class="at">main=</span><span class="st">"Modelo 9 (cauchit)"</span>)</span>
<span id="cb60-283"><a href="#cb60-283" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-284"><a href="#cb60-284" aria-hidden="true" tabindex="-1"></a>**Conclusión**: Se elige el modelo con el AUC más alto (en este caso, <span class="in">`fit7b`</span>).</span>
<span id="cb60-285"><a href="#cb60-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-286"><a href="#cb60-286" aria-hidden="true" tabindex="-1"></a><span class="fu">## Elección del Punto de Corte (`tau`) Óptimo</span></span>
<span id="cb60-287"><a href="#cb60-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-288"><a href="#cb60-288" aria-hidden="true" tabindex="-1"></a>Una vez elegido el mejor modelo (<span class="in">`fit7b`</span>), se debe seleccionar un punto de corte (<span class="in">`tau`</span>) para convertir las probabilidades predichas en clasificaciones ("Dead" / "Alive"). La elección de <span class="in">`tau`</span> depende del objetivo (minimizar errores, maximizar precisión, etc.).</span>
<span id="cb60-289"><a href="#cb60-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-292"><a href="#cb60-292" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb60-293"><a href="#cb60-293" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: ej3-tau</span></span>
<span id="cb60-294"><a href="#cb60-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-295"><a href="#cb60-295" aria-hidden="true" tabindex="-1"></a>tau <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>, <span class="at">by =</span> <span class="fl">0.05</span>)</span>
<span id="cb60-296"><a href="#cb60-296" aria-hidden="true" tabindex="-1"></a>AER <span class="ot">&lt;-</span> recall <span class="ot">&lt;-</span> precision <span class="ot">&lt;-</span> F1 <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb60-297"><a href="#cb60-297" aria-hidden="true" tabindex="-1"></a>exito <span class="ot">&lt;-</span> <span class="st">"1"</span>; frac <span class="ot">&lt;-</span> <span class="st">"0"</span></span>
<span id="cb60-298"><a href="#cb60-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-299"><a href="#cb60-299" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(tau)){</span>
<span id="cb60-300"><a href="#cb60-300" aria-hidden="true" tabindex="-1"></a>    glm.pred <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="st">"0"</span>, <span class="fu">length</span>(testres))</span>
<span id="cb60-301"><a href="#cb60-301" aria-hidden="true" tabindex="-1"></a>    glm.pred[pr7b <span class="sc">&gt;</span> tau[i]] <span class="ot">&lt;-</span> <span class="st">"1"</span></span>
<span id="cb60-302"><a href="#cb60-302" aria-hidden="true" tabindex="-1"></a>    tab<span class="ot">&lt;-</span><span class="fu">table</span>(glm.pred, testres)</span>
<span id="cb60-303"><a href="#cb60-303" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span>frac <span class="sc">%in%</span> <span class="fu">rownames</span>(tab)){</span>
<span id="cb60-304"><a href="#cb60-304" aria-hidden="true" tabindex="-1"></a>      tab<span class="ot">&lt;-</span><span class="fu">rbind</span>(tab,<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))</span>
<span id="cb60-305"><a href="#cb60-305" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rownames</span>(tab)[<span class="dv">2</span>]<span class="ot">&lt;-</span>frac</span>
<span id="cb60-306"><a href="#cb60-306" aria-hidden="true" tabindex="-1"></a>    } </span>
<span id="cb60-307"><a href="#cb60-307" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span>exito <span class="sc">%in%</span> <span class="fu">rownames</span>(tab)){</span>
<span id="cb60-308"><a href="#cb60-308" aria-hidden="true" tabindex="-1"></a>      tab<span class="ot">&lt;-</span><span class="fu">rbind</span>(tab,<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))</span>
<span id="cb60-309"><a href="#cb60-309" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rownames</span>(tab)[<span class="dv">2</span>]<span class="ot">&lt;-</span>exito</span>
<span id="cb60-310"><a href="#cb60-310" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb60-311"><a href="#cb60-311" aria-hidden="true" tabindex="-1"></a>    AER[i]<span class="ot">&lt;-</span>(tab[exito,frac]<span class="sc">+</span>tab[frac,exito])<span class="sc">/</span><span class="fu">sum</span>(tab)</span>
<span id="cb60-312"><a href="#cb60-312" aria-hidden="true" tabindex="-1"></a>    precision[i]<span class="ot">&lt;-</span>(tab[exito,exito])<span class="sc">/</span><span class="fu">sum</span>(tab[exito,])</span>
<span id="cb60-313"><a href="#cb60-313" aria-hidden="true" tabindex="-1"></a>    recall[i]<span class="ot">&lt;-</span>(tab[exito,exito])<span class="sc">/</span><span class="fu">sum</span>(tab[,exito])</span>
<span id="cb60-314"><a href="#cb60-314" aria-hidden="true" tabindex="-1"></a>    F1[i]<span class="ot">&lt;-</span><span class="dv">2</span><span class="sc">*</span>precision[i]<span class="sc">*</span>recall[i]<span class="sc">/</span>(precision[i]<span class="sc">+</span>recall[i])</span>
<span id="cb60-315"><a href="#cb60-315" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb60-316"><a href="#cb60-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-317"><a href="#cb60-317" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(tau,AER,precision,recall,F1)</span>
<span id="cb60-318"><a href="#cb60-318" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-319"><a href="#cb60-319" aria-hidden="true" tabindex="-1"></a>**Análisis**: Para elegir el `tau` óptimo, se busca un equilibrio. La métrica **F1**, que es la media armónica de la precisión y el recall, es una excelente opción para datos desbalanceados. El <span class="in">`tau`</span> que maximiza F1 sería una buena elección.</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




</body></html>